%!TEX root = /home/renaud/Documents/EPL/tfe/latex/tfe.tex
\section{Application of the method on a simple class of problems}
This section can be considered as a kind of \textit{sanity check} of the method: we define a class of problems for which the box decomposition is intuitively obvious and we check that a community detection algorithm applied on the problem allows to find back that box-decomposition. We call that class of problems the \textit{bi-overturner} problems. The domain that we consider is $\Omega = [-L,\,L]\times[0,\,H]$. Bi-overturner problems basically consist of two \textit{overturner-like} circulations models side-by-side. Let $\Omega^- = [-L,\,0[\times[0,\,H]$ and $\Omega^+ =\; ]0,\,L]\times[0,\,H]$. If $\psi(y,z;y_0,z_0)$ denote the streamfunction defined in \eqref{eq:psi_overturner} with parameters $y_0 \in\; ]0,\,L[$ and $z_0 \in\; ]0,\,H[$, then the streamfunction $\psi_2$ of the bi-overturner problems is defined as
\begin{equation} \label{eq:psi_2box}
	\psi_2(y,z) = \left\{ 
		\begin{array}{lrr}
			\psi(L+y,z;y_0,z_0) & \mbox{if} & (y,z) \in \Omega^-,\\
			0 & \mbox{if} & (y,z) \in \{(0,z)\;|\;z \in [0,\,H]\},\\
			-\psi(y,z;L-y_0,z_0) & \mbox{if} & (y,z) \in \Omega^+,\\
		\end{array}
	\right.
\end{equation}
The streamfunction $\psi_2$ has two extrema of equal strengths: a maximum at $(y_0^-,z_0)$ with $y_0^- \triangleq -L+y_0 = -y_0^-$ and a minimum at $(y_0^+,z_0)$ with $y_0^+ \triangleq L-y_0$. The overturner-like circulation is clockwise in $\Omega^-$ and counterclockwise in $\Omega^+$. The horizontal and vertical velocities $v$ and $w$ are given by
\begin{equation} \label{eq:u-psi_2box}
	v = -\frac{\partial \psi_2}{\partial z}, \quad w = \frac{\partial \psi_2}{\partial y}.
\end{equation}
 Isolines are shown in figures \ref{fig:v2box} and \ref{fig:w2box} respectively. The key feature is that $v(0,z) = 0$, namely the horizontal velocity is zero on the whole segment $y = 0$. Hence, if there is no horizontal diffusion, a passive tracer's particle starting in $\Omega^-$ can never reach $\Omega^+$ and conversely. In that case, we can imagine that there is a vertical wall implying no-through boundary conditions at $y=0$ and the graph is not ergodic. But if the horizontal diffusivity is nonzero in some area near $y=0$, then exchange of particles between $\Omega^-$ and $\Omega^+$ can happen in that area. Now we suppose that the diffusivity tensor $\b K$ is diagonal:
 \begin{equation}
 	\b K(y,z) = \begin{pmatrix} K_h(y,z) & 0\\ 0 & K_v \end{pmatrix}.  	
 \end{equation} 
We assume that the vertical diffusivity $K_v$ is constant and equal to $10^{-3}$ [$\rm{m^2/s}$]. Now we introduce the parameter $\alpha \in [0,1]$ and define $z^* = \alpha H$. We choose an horizontal diffusivity $K_h$ of the form
\begin{equation} \label{eq:Kh2box}
	K_h(y,z) = \begin{cases}
			10^4\ \rm{[m^2/s]} & \mbox{if} \quad y_0^- \le y \le y_0^+ \quad \mbox{and} \quad z^* \le z \le H,\\
			10^3\ \rm{[m^2/s]} & \mbox{if} \quad -L \le y < y_0^- \quad \mbox{or} \quad y_0^+ < y \le L,\\
			0\ \rm{[m^2/s]}  & \mbox{otherwise}.
		\end{cases}
\end{equation}
Now, exchange between $\Omega^-$ and $\Omega^+$ is possible but only above $z^*$.\footnote{From a numerical, random-walk, point of view, we should also ensure that $y_0^+ = |y_0^-|$ is sufficiently large. If not, it would be numerically possible for particles lying below $z^*$ and before $y_0^-$ (resp. after $y_0^+$) to jump from $\Omega^-$ (resp. $\Omega^+$) to $\Omega^+$ (resp. $\Omega^-$).} For the next, we call \textit{exchange zone} the area where $K_v = 10^4$ $\rm{[m^2/s]}$ (dark gray zone in figure \ref{fig:Kh2box}) Hence, we can imagine that there is a vertical, no-through wall of height $z^*$ at $y=0$. The situation is depicted on figure \ref{fig:Kh2box}. Making $\alpha$ vary between $0$ and $1$ defines a class of bi-overturner problem where the vertical wall's height $z^*$ at $y=0$ vary between $0$ and $H$. Two examples of trajectories with the same initial condition are shown for $\alpha = 0.75$ in figures \ref{fig:withouttransfer} and \ref{fig:withtransfer}.

\begin{figure}[!htp]
	\centering
	\includegraphics[width=\textwidth]{fig/problem2box/v2box_timmermans.eps}
	\caption{Isolines of the horizontal velocity $v$ for bi-overturner problems.}
	\label{fig:v2box}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width=\textwidth]{fig/problem2box/w2box_timmermans.eps}
	\caption{Isolines of the horizontal velocity $w$ for bi-overturner problems.}
	\label{fig:w2box}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width=\textwidth]{fig/problem2box/problem.eps}
	\caption{Illustration of the decomposition of the domain into boxes corresponding to the nodes of the directed graph. The values of $K_h$ are also shown for $\alpha = 0.6$, and the fictitious wall is represented by the black continuous line. Here the particle enters the exchange zone but finally stays in $\Omega^-$.}
	\label{fig:Kh2box}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width=\textwidth]{fig/problem2box/traj_without_transfer5.eps}
	\caption{Example of a particle trajectory in the bi-overturner model with $\alpha = 0.75$. The black cross represents the initial position whereas the black dot shows the final position. The simulation time is 200 years.}
	\label{fig:withouttransfer}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width=\textwidth]{fig/problem2box/traj_with_transfer2.eps}
	\caption{Example of a particle trajectory in the bi-overturner model with $\alpha = 0.75$. The black cross represents the initial position whereas the black dot shows the final position. The simulation time is 200 years.}
	\label{fig:withtransfer}
\end{figure}
When $\alpha = 1$, the obvious compartmental model is made of the two compartments $\Omega^-$ and $\Omega^+$ which do not communicate with each other. Suppose that different amounts of passive tracer are released into $\Omega^-$ and $\Omega^+$ at a given time; the concentration in each compartment tends to become uniform in time due to diffusion, but the concentration in $\Omega^-$ depends only on the initial quantity of tracer released in $\Omega^-$ and similarly for the concentration in $\Omega^+$. At the contrary, when $\alpha = 0$ the concentration tends to become uniform over the whole domain when time goes to infinity. Hence, we can expect three types of partitioning: a three-communities partitioning with left and right compartments and an exchange zone in between; a two-communities partitioning corresponding to $\Omega^-$ and $\Omega^+$; and finally a trivial partitioning with one single community for very long time scales. For intermediate values of $\alpha$, we expect a behavior similar to the case $\alpha = 1$ when $\alpha$ is close to $1$ and similar to the case $\alpha = 0$ when $\alpha$ goes to $0$. 

\subsection{Results}
The partitioning results are presented here for $\alpha = 1$, $\alpha = 0.75$, $\alpha = 0.5$, $\alpha = 0.25$ and $\alpha = 0$. For every value of $\alpha$, the transition probability matrix is computed at $T = 1$ year on a discretization like the one presented in figure \ref{fig:Kh2box}, namely with $\nby = 30$ and $\nbz = 10$. $10\,000$ particles are initially released in every box. The stability software is run using a vector of Markov times taking values between $10$ and $10^3$. Since we have computed the transition probability matrix for $T = 1$ year, one unit of Markov time correspond here to one year. Notice that in the case where $\alpha = 1$, the graph is not ergodic (it is composed of two ergodic classes) and a random teleportation probability \mtlb{tau} $= 10^{-3}$ is used when running the stability software. When $\alpha < 1$, \mtlb{tau} $=0$ is used.
The stability, number of communities and variation of information curves are shown in figures \ref{fig:staba1}, \ref{fig:staba75}, \ref{fig:staba5}, \ref{fig:staba25} and \ref{fig:staba0} for different values of $\alpha$. Most robust communities correspond to plateaux in the community curve together with a low variation of information. Whatever the value of $\alpha$, the number of communities goes to $2$ after maximum $50$ years, together with a variation of information that is almost zero. In every case, the two-communities partitioning corresponds as expected to $\Omega^-$ and $\Omega^+$. It is shown in figure \ref{fig:cluster_a25_2} for the case $\alpha = 0.25$. In that case, the boundary is perfectly straight which corresponds to the intuition and is conform to the remark made on page \pageref{remark:straightboundaries}. In some other cases, like when $\alpha = 0.5$, the boundary is not exactly a straight line. The situation is depicted in figure \ref{fig:cluster_a5_2}. However, we have to remember that neither the transition probability matrix nor the stability partitioning is solved exactly. Hence, we can consider that the irregularity in the boundary of the communities is due to those numerical artifacts: if a box-model has to be build from the partitioning shown in figure \ref{fig:cluster_a5_2}, the compartments should of course be chosen with a vertical boundary. This illustrates the fact that when using a community-detection algorithm to build compartments for a box-model, the communities should not be blindly interpreted as being the relevant compartments. In particular, if the boundaries of the communities are almost but not exactly vertical and horizontal, one should consider straight boundaries for the compartments. Community detection should thus be considered as a guide towards choosing relevant compartments, rather than as an exact method.

When $\alpha = 0.75$, a small three-communities plateaux starts appearing around 40 years. This plateau grows as $\alpha$ decreases. The corresponding clusterings are shown in figures \ref{fig:cluster_a25_3} and \ref{fig:cluster_a0_3}, where a community corresponding to the exchange zone appears, as expected.

In figure \ref{fig:staba0} corresponding to the case $\alpha = 0$, peaks corresponding to oscillations between two and three communities are observed around 300 and 400 years. As stated in section \ref{sec:stability}, the number of communities should decrease with time, and those oscillations are thus due to the fact that the stability partitioning is only solved approximately. However, this shows that the two- and three-communities clusterings have similar stabilities at those times. Notice that in that case, we expected to find a single-community partitioning for very long Markov times, which does not appear here. Such a clustering would probably appear if we run the stability software for longer Markov times.

Hopefully this introductory example shows how a community-detection algorithm could be use to build compartment models, and provide intuition about why it could work. The communities found depend on the time scale considered but this is not a problem since it could also be the case for the compartments. Notice that we do not to build compartmental models for the bi-overturner class of problems because the compartments are obvious in this case, and it is thus not the goal of this section. In the next section, the method is applied on the overturner problem and we should try to build a compartmental model for that problem. 

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth, height = .4\textheight]{fig/problem2box/stab_a1.eps}
	\caption{Stability, number of communities and variation of information as a function of the Markov time for $\alpha = 1$.}
	\label{fig:staba1}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth, height = .4\textheight]{fig/problem2box/stab_a75.eps}
	\caption{Stability, number of communities and variation of information as a function of the Markov time for $\alpha = 0.75$.}
	\label{fig:staba75}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth, height = .4\textheight]{fig/problem2box/stab_a5.eps}
	\caption{Stability, number of communities and variation of information as a function of the Markov time for $\alpha = 0.5$.}
	\label{fig:staba5}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth, height = .4\textheight]{fig/problem2box/stab_a25.eps}
	\caption{Stability, number of communities and variation of information as a function of the Markov time for $\alpha = 0.25$.}
	\label{fig:staba25}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth, height = .4\textheight]{fig/problem2box/stab_a0.eps}
	\caption{Stability, number of communities and variation of information as a function of the Markov time for $\alpha = 0$.}
	\label{fig:staba0}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth]{fig/problem2box/cluster_a25_2_.eps}
	\caption{Illustration of the two-communities partitioning for $\alpha = 0.25$.}
	\label{fig:cluster_a25_2}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth]{fig/problem2box/cluster_a5_2_.eps}
	\caption{Illustration of the two-communities partitioning for $\alpha = 0.5$.}
	\label{fig:cluster_a5_2}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth]{fig/problem2box/cluster_a25_3_.eps}
	\caption{Illustration of the three-communities partitioning for $\alpha = 0.25$.}
	\label{fig:cluster_a25_3}
\end{figure}

\begin{figure}[!htp]
	\centering
	\includegraphics[width = .7\textwidth]{fig/problem2box/cluster_a0_3_.eps}
	\caption{Illustration of the three-communities partitioning for $\alpha = 0$.}
	\label{fig:cluster_a0_3}
\end{figure}

\newpage
\section{Building a compartment model}
Let us now focus on the case $\alpha = 0.75$. The community detection method applied in the previous section suggests a two compartments model with $\Omega_1 = \Omega^-$ and $\Omega_2 = \Omega^+$. We consider a \textit{passive} tracer and the domain is \textit{isolated}. Two approaches are proposed in order to build a compartment model: in section \ref{sec:ctcm}, a continuous-time compartment model is build which depends on one parameter, and the analytical solution to that compartment model is used to compute a relevant value for that parameter; in section \ref{sec:dtcm}, a discrete-time compartment model is build which also depends on one parameter, and a numerical simulation is used to estimate that parameter.  

\subsection{Continuous-time compartment model} \label{sec:ctcm}
Let $\b A$ be the $2 \times 2$ interaction matrix, and let $\b c$ and $\bs \Omega$ be defined as in \eqref{eq:def_compartment_vars}. The evolution of the concentration in the two compartments is given by
\begin{equation} \label{eq:generalEDOp2b}
 	\bs \Omega \b{\dot{c}} = \b A \b c.
\end{equation}
It remains to propose an expression for $\b A$. In the general case, a $2 \times 2$ matrix such as $\b A$ has four independent entries. However, properties \ref{prop1bis_comp}, \ref{prop2bis_comp} and \ref{prop3bis_comp} shown in chapter \ref{chap:compartment} imply that $\b A$ has only one degree of freedom. Moreover, for $a > 0$, $\b A$ must have the following form:
\begin{equation} \label{eq:A}
	\b A = \begin{pmatrix}
		-a & a\\
		a & -a
	\end{pmatrix}.
\end{equation}
This is nothing but a straightforward implication of the combination of the three properties. Another way of seeing this is by looking at the general form of $\b A$ shown in \eqref{eq:generalA}. In this case, that expression reduces to (remember that $U_{i,i} = 0 = V_{i,i}$):
\begin{equation} \label{eq:Atemp}
	\b A = \begin{pmatrix}
		-\frac{1}{2} U_{1,2} - V_{1,2} & -\frac{1}{2}U_{1,2} + V_{1,2}\\
		-\frac{1}{2}U_{2,1} + V_{2,1} & -\frac{1}{2}U_{2,1} - V_{2,1}
	\end{pmatrix}.
\end{equation}
By the continuity equation for the compartment model \eqref{eq:continuitycompartment}, $U_{1,2} = U_{2,1} = 0$, and by the property \eqref{eq:Vprop} of $V_{i,j}$, $V_{1,2} = V_{2,1} > 0$. With those considerations, \eqref{eq:Atemp} simplifies to
\begin{equation}
	\b A = \begin{pmatrix}
		- V_{1,2} & V_{1,2}\\
		V_{1,2} & -V_{1,2}
	\end{pmatrix},
\end{equation}
which is exactly \eqref{eq:A} with $V_{1,2} = a$.

The compartment model considered here has in fact an analytic solution that is relatively easy to compute. Indeed, by property \ref{prop1_comp}, the mean concentration over the whole domain is constant:
\begin{equation}
	\bar C(t) = \bar C = \frac{\Omega_1 C_1 + \Omega_2 C_2}{\Omega} = \frac{C_1 + C_2}{2}.
\end{equation}
Hence, we can express $C_2$ as a linear function of $C_1$:
\begin{equation}
	C_2 = 2\bar C - C_1,
\end{equation}
and \eqref{eq:generalEDOp2b} reduces to a simple ODE in $C_1$ with one parameter $a$:
\begin{equation} \label{eq:edoC1_p2b_a75}
	\frac{dC_1}{dt} = -2aC_1 + 2a\bar C,
\end{equation}
where we have redefined $a$ as $V_{1,2}/\Omega_1$ in order to simplify the notations. Let $C_{1,0}$ be the initial condition on $C_1$, namely $C_1(0) = C_{1,0}$. The solution to \eqref{eq:edoC1_p2b_a75} is easy to compute:
\begin{equation}
	C_1(t) = (C_{1,0} - \bar C) \Exp^{-2at} + \bar C.
\end{equation}
Let us consider the scaled form of the concentration $\tilde C_1 = C_1/\bar C$. The solution is expressed in terms of $\tilde C_1$ as:
\begin{equation}
	\tilde C_1(t) = (\tilde C_{1,0} - 1) \Exp^{-2at} + 1.
\end{equation}

The goal now is to estimate the parameter $a$. To this end, we propose the following approach:
\begin{enumerate}
	\item Run a simulation on a particular instance of the bi-overturner problem (i.e. a particular initial condition).
	\item Using that simulation, compute the average concentration in $\Omega_1$ at $m$ different times $t_0 < t_1 < \dots < t_m$. For the next, let $\bar C_1(t)$ denote the average concentration over $\Omega_1$ at time $t$ (whereas $C_1(t)$ stands for the compartment model concentration in the compartment corresponding to the subdomain $\Omega_1$).
	\item Apply the method of least squares to compute $a$:
	\begin{equation} \label{eq:a_minimization}
		a = \argmin_a \sum_{i=1}^m \left(C_1(t_i)-\bar C_1(t_i)\right)^2.
	\end{equation}
\end{enumerate}
This method leads to a value of $a$ based on one single particular instance of the problem (i.e. a particular initial condition). Of course, we will need to check that the results obtained for other initial conditions are sufficiently close to the simulations.

The method is applied for the initial condition $\tilde C_1(0) = 1$ (and hence $\tilde C_2(0) = 0$), and with the tracer particles initially uniformly distributed over $\Omega_1$. The simulation is run for 1000 years, and $\bar C_1(t)$ is evaluated every year. The minimization of \eqref{eq:a_minimization} is performed in \matlab using the Gauss-Newton algorithm, which is well-suited to solve non-linear least squares problems.\footnote{See for example the wikipedia page of the algorithm : \url{https://en.wikipedia.org/wiki/Gauss-Newton_algorithm}.} The value 
\begin{equation}
	a = 0.003125
\end{equation}
is found. Figure \ref{fig:comparison_comp-real1} compares the evolution of $\tilde C_1(t) = C_1(t)/\bar C$, the analytical solution of the compartment model, with the evolution of $\tilde C_1(t)/\bar C$, the scaled mean value of the concentration over $\Omega_1$ computed numerically, which we may consider as an approximation of the exact solution.

\textcolor{red}{todo : autres conditions initiales}

\subsection{Discrete-time compartment model} \label{sec:dtcm}
When there are more than two compartments, finding an analytic solution is not always possible and the methodology presented in the previous section cannot be applied. For this reason, another approach is proposed in this section. 
\subsubsection{The method}
Here a \textit{discrete} interaction matrix $\b A_{\Delta t}$ is build based on a numerical simulation over a period $\Delta t$. This methodology is thus far more general than the one presented in the previous section. It goes as follows: to compute the entry $[\b A_{\Delta t}]_{i,j}$, run a simulation over a period $\Delta t$, with all the particles initially uniformly distributed over compartment $j$ (i.e. subdomain $\Omega_j$). Let $J$ be the total number of particles, and $J_{j \rightarrow i}(\Delta t)$ the number of particles amongst those initially in box $j$ that ends up in compartment $i$ after a time $\Delta t$. The factor $\frac{J_{j \rightarrow i}(\Delta t)}{J}$ is an approximation of the probability to go from compartment $j$ to compartment $i$ within a time period $\Delta t$. But this probability is precisely given by $\frac{\Omega_i}{\Omega_j}[\b A_{\Delta t}]_{i,j}$, as explained page \pageref{page:probability_interpretation}. We have thus the approximation
\begin{equation} \label{eq:A_approx_discr}
	[\b A_{\Delta t}]_{i,j} \approx \frac{J_{j \rightarrow i}(\Delta t)}{J}\frac{\Omega_j}{\Omega_i}.
\end{equation}
Using that formula to compute an approximation of $\b A_{\Delta t}$, it is seen that properties \ref{prop1_discr_comp}, \ref{prop2_discr_comp} and \ref{prop5_discr_comp} are always respected \textit{a priori}. Properties \ref{prop3_discr_comp} and \ref{prop4_discr_comp} should by verified a posteriori.
\subsubsection{Results}
In a first instance, we can take advantage of the properties developed in section \ref{sec:dtcm(chapcomp)} to deduce the general form of $\b A_{\Delta t}$ for this problem. In the present case, $\Omega_1$ and $\Omega_2$ have the same size; this implies that property \ref{prop2_discr_comp} reduces to corollary \ref{corollary2}, and that property \ref{prop5_discr_comp} becomes equivalent to property \ref{prop4_discr_comp}. Putting everything together, the matrix $\b A_{\Delta t}$ that we search is a $2 \times 2$ matrix whose entries are comprised between 0 and 1 and which satisfies $\b 1^\t \b A_{\Delta t} = \b 1^\t$ and $\b A_{\Delta t} \b 1= \b 1$. This implies that $\b A_{\Delta t}$ must have the following form:
\begin{equation} \label{eq:generalformAdeltat}
	\b A_{\Delta t} = \begin{pmatrix}
		a & 1-a\\ 1-a & a
	\end{pmatrix},
\end{equation}
for some $a \in [0,\,1]$.

The discrete interaction matrix is approximated for $\Delta t = 1$ year with $J = 10\ 000$. \textcolor{red}{Mentionner l'étude de convergence, mais la rendre plus rigoureuse.} Using formula \eqref{eq:A_approx_discr}, we get
\begin{equation}
	\b A_1 = \begin{pmatrix}
		0.9839 & 0.0159 \\ 
		0.0161 & 0.9841
	\end{pmatrix}.
\end{equation}
This approximation of $\b A_1$ does not exactly match the general form \eqref{eq:generalformAdeltat}. Hence, we improve that approximation by choosing $a$ as an average:
\begin{equation}
	a = \frac{[\b A_1]_{1,1} + (1-[\b A_1]_{1,2}) + (1 - [\b A_1]_{2,1}) + [\b A_1]_{2,2}}{4} = 0.9840,
\end{equation}
leading to
\begin{equation}
	\b A_1^{discr,1} = \begin{pmatrix}
		0.9840 & 0.0160 \\ 
		0.0160 & 0.9840
	\end{pmatrix},
\end{equation}
which match the general form \eqref{eq:generalformAdeltat}. For any initial condition, we can now approximate the concentration in both compartments after $T$ years as
\begin{equation}
	\b c^{discr,1}(T) = \left(\b A_1^{discr,1}\right)^T \b c(0).
\end{equation}
The resulting evolution of the concentration in compartment 1 is shown in figure \ref{fig:comparison_comp-real1} for the initial condition $\b c(0) = (2\bar C,0)^\t$. Clearly, this result is not satisfying as the concentration decreasing much too fast in compartment 1. Therefore, we propose another way of estimating $\b A_1$ that leads to better results: instead of running the numerical over a period of 1 year, we run a 50 years simulation to compute $\b A_{50}$. The choice of 50 years is motivated by the fact that the two-communities clustering appears approximately at that time scale, as shown in figure \ref{fig:staba75}. Then, $\b A_1$ is approximated as
\begin{equation}
	\b A_1 = \left(\b A_{50}\right)^{\frac{1}{50}},
\end{equation}
and a small correction is applied (as in the previous method) in order to match the general form \eqref{eq:generalformAdeltat}. Doing this, we get
\begin{equation}
	\b A_1^{discr,2} = \begin{pmatrix}
		0.9972 & 0.0028 \\ 
		0.0028 & 0.9972
	\end{pmatrix},
\end{equation}
leading to the approximation
\begin{equation}
	\b c^{discr,2}(T) = \left(\b A_1^{discr,2}\right)^T \b c(0).
\end{equation}
The resulting evolution is also shown in figure \ref{fig:comparison_comp-real1}. The result is far better than with the first method.

\begin{figure}[!htp]
	\centering
	\includegraphics[scale=1]{fig/problem2box/C1vsC1tilde1_1000years2.eps}
	\caption{Comparison of the compartment model solution with the numerical solution for the initial condition $C_1(0) = \bar C$.}
	\label{fig:comparison_comp-real1}
\end{figure}