%!TEX root = /home/renaud/Documents/EPL/tfe/latex/tfe.tex
\chapter{Numerical Considerations} \label{chap:numerical}
\textcolor{red}{À retravailler une fois le travail fini.}
The final goal of this work is to develop a simpler box-model of the overturner model, where the boxes are determined via a community detection method. In order to apply such a community detection method, the solution to the overturner transport model \eqref{eq:C_PDE_vec} must be computed at different times and for different initial conditions. However, equation \eqref{eq:C_PDE_vec} cannot be solved analytically so that numerical methods must be resorted to. A lot of different numerical methods have been developed through the years, each having their pros and cons. Here, we briefly summarize the main types of methods available, with their main advantages and disadvantages. This allows then to make an informed decision about which method to use in this work. Most of the discussion in the following paragraphs is inspired from \cite{spivakovskaya2007lagrangian} and \cite{spivakovskaya2007backward}. 

A very popular class of numerical methods is formed by the Eulerian methods, in which the advection-diffusion equation is solved on a fixed spatial grid. This class encompass the finite difference method, finite element method and finite volume method. A second class is formed by the Lagrangian methods, where particles are followed through space at every time step. As we shall see later, the movement of an individual particle is modeled with a stochastic differential equation (SDE) which is consistent with the advection-diffusion equation. The idea is to estimate the concentration by simulating the trajectories of a large number of particles and taking averages. Several averaging methods have been developed to estimate the concentration from the set of particles positions: we shall come back to this further in section \ref{boxcounting_kernel}. Finally, a third class of mixed Eulerian-Lagrangian methods has been developed, which basically attempts to combine the advantages of both approaches. Such conceptually attractive methods have been widely applied in applications. They are however more complex to implement; in view of the relative simplicity of the overturner problem, we will not consider such mixed methods here.

Both Eulerian and Lagrangian methods have their own advantages and disadvantages. The Eulerian methods provide the convenience of a fixed grid and are easy to implement. The main drawbacks are the inherent dispersion errors and artificial oscillations, leading to solutions that may be neither mass conservative nor positive \cite{stijn1987positive}, \cite{yang1998accuracy}. Basically, the effect of dispersion errors is similar to physical dispersion but it is due to truncation errors. Artificial oscillations are typical from higher order methods designed to reduce dispersion errors. Those downsides could become excessively severe in case of problems involving a sharp concentration front, for instance advection-dominated problems or problems with large gradients on the initial concentration field (typically delta-like initial concentration) \cite{zheng2002applied}. In those cases, numerical dispersion (i.e. dispersion due to dispersion errors) tends to inappropriately smooth out the sharp concentration front, whereas artificial oscillations tends to become more important, leading to serious problem with the positiveness of the solution. 

On the other hand, Lagrangian methods ensures that the solution is always mass conservative and nonnegative. They are thus more suited than Eulerian methods to advection-dominated problems and to problems with large concentration gradients, since they do not suffer from dispersion errors and artificial oscillations. Moreover, if the tracer does not occupy the whole domain, the Lagrangian methods may be computationally more efficient than their Eulerian counterpart \cite{hunter1987application}. Depending on the number of particles used, Lagrangian methods may also require less storage than finite differences or finite element methods. Another advantage of Lagrangian methods is that they make it possible to advect the particles exactly when  the velocity field can locally be described by an analytical function \cite{hunter1993use}. Finally, because each realization of the particle movement is independent from the others, Lagrangian methods are perfect candidates for parallelization. For instance, the MPI library makes it pretty easy and efficient to parallelize a code based on random walk models. Among the drawbacks of particle methods, the lack of a fixed grid may lead to numerical instability and computational difficulties \cite{yeh1990lagrangian}. If flow variables are not known analytically, their interpolation to the particle location could lead to local mass balance errors and solution anomalies \cite{labolle1996random}. Finally, the number of particles needed to get a smooth solution might be large leading to a large computational time, but this can be compensated by a parallelization of the code.

Considering the above discussion, it seems that a Lagrangian method is more appropriate for our concern. Indeed, in order to build an approximation of the transition probability matrix, the domain $\Omega$ is partitioned into grid cells or boxes. For a simulation time $T$, an entry $[\b M(T)]_{ij}$ is the probability that a particle goes from box $i$ to box $j$ in a time $T$. To estimate the entries of a line $i$ of the matrix, the idea is to run a simulation for a time $T$ and an initial concentration which is uniform in box $i$ and zero in every other box. The initial concentration is thus sharp, a first argument in favor of a Lagrangian method. Furthermore, the concentration is interpreted as a probability, hence positiveness and mass conservation are crucial topics, another point for Lagrangian methods. Finally, the flow variables are in our case known analytically, which considerably reduce the drawbacks of Lagrangian methods pointed out above. For these reasons, we choose to go for a Lagrangian method. 
% Concentration initiale sharp
% concentration interprétée comme une proba -> positiveness & mass conservation ++
% flow variables known analytically : dans ce cas la plupart des désavantages exprimés ci-dessus sont sans objet
\input{inputs/numerical/preliminaries}
\input{inputs/numerical/lagrangianequations}
\input{inputs/numerical/sde2D}